From 7865041c77f4f7005282f10f9b6666b19072fbdf Mon Sep 17 00:00:00 2001
From: NIIBE Yutaka <gniibe@fsij.org>
Date: Mon, 15 Apr 2019 15:10:44 +0900
Subject: [PATCH] awk: Prepare for Gawk 5.0.

* src/Makefile.am: Use pkg_namespace (instead of namespace).
* src/mkerrnos.awk: Likewise.
* lang/cl/mkerrcodes.awk: Don't escape # in regexp.
* src/mkerrcodes.awk, src/mkerrcodes1.awk, src/mkerrcodes2.awk: Ditto.

--

In Gawk 5.0, regexp routines are replaced by Gnulib implementation,
which only allows escaping specific characters.

GnuPG-bug-id: 4459
Reported-by: Marius Schamschula
Signed-off-by: NIIBE Yutaka <gniibe@fsij.org>
---
 lang/cl/mkerrcodes.awk |  2 +-
 src/Makefile.am        |  2 +-
 src/Makefile.in        |  2 +-
 src/mkerrcodes.awk     |  2 +-
 src/mkerrcodes1.awk    |  2 +-
 src/mkerrcodes2.awk    |  2 +-
 src/mkerrnos.awk       |  2 +-
 src/mkstrtable.awk     | 10 +++++-----
 7 files changed, 11 insertions(+), 11 deletions(-)

diff -Naur a/lang/cl/mkerrcodes.awk b/lang/cl/mkerrcodes.awk
--- a/lang/cl/mkerrcodes.awk	2013-03-15 20:24:25.000000000 +0100
+++ b/lang/cl/mkerrcodes.awk	2020-07-16 07:33:51.685744379 +0200
@@ -122,7 +122,7 @@
 }
 
 !header {
-  sub (/\#.+/, "");
+  sub (/#.+/, "");
   sub (/[ 	]+$/, ""); # Strip trailing space and tab characters.
 
   if (/^$/)
diff -Naur a/src/Makefile.am b/src/Makefile.am
--- a/src/Makefile.am	2018-12-12 09:14:31.000000000 +0100
+++ b/src/Makefile.am	2020-07-16 07:33:51.685744379 +0200
@@ -293,7 +293,7 @@
 
 errnos-sym.h: Makefile mkstrtable.awk errnos.in
 	$(AWK) -f $(srcdir)/mkstrtable.awk -v textidx=2 -v nogettext=1 \
-		-v prefix=GPG_ERR_ -v namespace=errnos_ \
+		-v prefix=GPG_ERR_ -v pkg_namespace=errnos_ \
 		$(srcdir)/errnos.in >$@
 
 
diff -Naur a/src/Makefile.in b/src/Makefile.in
--- a/src/Makefile.in	2019-01-28 07:59:23.000000000 +0100
+++ b/src/Makefile.in	2020-07-16 07:34:27.976850323 +0200
@@ -1615,7 +1615,7 @@
 
 errnos-sym.h: Makefile mkstrtable.awk errnos.in
 	$(AWK) -f $(srcdir)/mkstrtable.awk -v textidx=2 -v nogettext=1 \
-		-v prefix=GPG_ERR_ -v namespace=errnos_ \
+		-v prefix=GPG_ERR_ -v pkg_namespace=errnos_ \
 		$(srcdir)/errnos.in >$@
 
 mkheader$(EXEEXT_FOR_BUILD): mkheader.c Makefile
diff -Naur a/src/mkerrcodes1.awk b/src/mkerrcodes1.awk
--- a/src/mkerrcodes1.awk	2013-03-15 20:24:25.000000000 +0100
+++ b/src/mkerrcodes1.awk	2020-07-16 07:33:51.685744379 +0200
@@ -81,7 +81,7 @@
 }
 
 !header {
-  sub (/\#.+/, "");
+  sub (/#.+/, "");
   sub (/[ 	]+$/, ""); # Strip trailing space and tab characters.
 
   if (/^$/)
diff -Naur a/src/mkerrcodes2.awk b/src/mkerrcodes2.awk
--- a/src/mkerrcodes2.awk	2013-03-15 20:24:25.000000000 +0100
+++ b/src/mkerrcodes2.awk	2020-07-16 07:33:51.685744379 +0200
@@ -91,7 +91,7 @@
 }
 
 !header {
-  sub (/\#.+/, "");
+  sub (/#.+/, "");
   sub (/[ 	]+$/, ""); # Strip trailing space and tab characters.
 
   if (/^$/)
diff -Naur a/src/mkerrcodes.awk b/src/mkerrcodes.awk
--- a/src/mkerrcodes.awk	2013-03-15 20:24:25.000000000 +0100
+++ b/src/mkerrcodes.awk	2020-07-16 07:33:51.685744379 +0200
@@ -85,7 +85,7 @@
 }
 
 !header {
-  sub (/\#.+/, "");
+  sub (/#.+/, "");
   sub (/[ 	]+$/, ""); # Strip trailing space and tab characters.
 
   if (/^$/)
diff -Naur a/src/mkerrnos.awk b/src/mkerrnos.awk
--- a/src/mkerrnos.awk	2013-03-15 20:24:25.000000000 +0100
+++ b/src/mkerrnos.awk	2020-07-16 07:33:51.685744379 +0200
@@ -83,7 +83,7 @@
 }
 
 !header {
-  sub (/\#.+/, "");
+  sub (/#.+/, "");
   sub (/[ 	]+$/, ""); # Strip trailing space and tab characters.
 
   if (/^$/)
diff -Naur a/src/mkstrtable.awk b/src/mkstrtable.awk
--- a/src/mkstrtable.awk	2013-03-15 20:24:25.000000000 +0100
+++ b/src/mkstrtable.awk	2020-07-16 07:33:51.685744379 +0200
@@ -77,7 +77,7 @@
 #
 # The variable prefix can be used to prepend a string to each message.
 #
-# The variable namespace can be used to prepend a string to each
+# The variable pkg_namespace can be used to prepend a string to each
 # variable and macro name.
 
 BEGIN {
@@ -102,7 +102,7 @@
       print "/* The purpose of this complex string table is to produce";
       print "   optimal code with a minimum of relocations.  */";
       print "";
-      print "static const char " namespace "msgstr[] = ";
+      print "static const char " pkg_namespace "msgstr[] = ";
       header = 0;
     }
   else
@@ -110,7 +110,7 @@
 }
 
 !header {
-  sub (/\#.+/, "");
+  sub (/#.+/, "");
   sub (/[ 	]+$/, ""); # Strip trailing space and tab characters.
 
   if (/^$/)
@@ -150,7 +150,7 @@
   else
     print "  gettext_noop (\"" last_msgstr "\");";
   print "";
-  print "static const int " namespace "msgidx[] =";
+  print "static const int " pkg_namespace "msgidx[] =";
   print "  {";
   for (i = 0; i < coded_msgs; i++)
     print "    " pos[i] ",";
@@ -158,7 +158,7 @@
   print "  };";
   print "";
   print "static GPG_ERR_INLINE int";
-  print namespace "msgidxof (int code)";
+  print pkg_namespace "msgidxof (int code)";
   print "{";
   print "  return (0 ? 0";
 
